<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Contact Me</title>
		<link rel="stylesheet" href="contact-us.css" />
	</head>
	<body>
		<header>
			<nav>
				<ul>
					<li><a href="index.html">Home</a></li>
					<li><a href="about-me.html">About Me</a></li>
				</ul>
			</nav>
		</header>

		<main class="content-wrapper">
			<section class="contact-section">
				<h1>Contact Me</h1>
				<p>Hi there, drop me a message!</p>

				<div
					id="success-message"
					class="message success"
					data-testid="test-contact-success"
					role="alert"
					hidden>
					Your message has been sent successfully! Thank you.
				</div>

				<form id="contact-form" novalidate>
					<div class="form-group">
						<label for="name">Full Name</label>
						<input
							type="text"
							id="name"
							data-testid="test-contact-name"
							required
							aria-describedby="error-name" />
						<span
							id="error-name"
							class="error-message"
							data-testid="test-contact-error-name"
							role="alert"
							hidden
							>Full name is required.</span
						>
					</div>

					<div class="form-group">
						<label for="email">Email</label>
						<input
							type="email"
							id="email"
							data-testid="test-contact-email"
							required
							aria-describedby="error-email" />
						<span
							id="error-email"
							class="error-message"
							data-testid="test-contact-error-email"
							role="alert"
							hidden
							>A valid email (e.g., name@example.com) is required.</span
						>
					</div>

					<div class="form-group">
						<label for="subject">Subject</label>
						<input
							type="text"
							id="subject"
							data-testid="test-contact-subject"
							required
							aria-describedby="error-subject" />
						<span
							id="error-subject"
							class="error-message"
							data-testid="test-contact-error-subject"
							role="alert"
							hidden
							>Subject is required.</span
						>
					</div>

					<div class="form-group">
						<label for="message">Message</label>
						<textarea
							id="message"
							data-testid="test-contact-message"
							rows="5"
							required
							minlength="10"
							aria-describedby="error-message"></textarea>
						<span
							id="error-message"
							class="error-message"
							data-testid="test-contact-error-message"
							role="alert"
							hidden
							>Message is required and must be at least 10 characters
							long.</span
						>
					</div>

					<button type="submit" data-testid="test-contact-submit">
						Send Message
					</button>
				</form>
			</section>
		</main>

		<script src="contact.js"></script>
	</body>
	<script>
		document.addEventListener("DOMContentLoaded", () => {
			const form = document.getElementById("contact-form");
			const successMessage = document.getElementById("success-message");

			// Input fields
			const nameInput = document.getElementById("name");
			const emailInput = document.getElementById("email");
			const subjectInput = document.getElementById("subject");
			const messageInput = document.getElementById("message");

			// Error message spans
			const nameError = document.getElementById("error-name");
			const emailError = document.getElementById("error-email");
			const subjectError = document.getElementById("error-subject");
			const messageError = document.getElementById("error-message");

			// Regex for basic email validation
			const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

			/**
			 * Shows an error message for a specific field.
			 * @param {HTMLElement} input - The input element.
			 * @param {HTMLElement} errorEl - The error message element.
			 * @param {string} message - The error message to display.
			 */
			function showError(input, errorEl, message) {
				errorEl.textContent = message;
				errorEl.hidden = false;
				input.setAttribute("aria-invalid", "true");
			}

			/**
			 * Hides an error message for a specific field.
			 * @param {HTMLElement} input - The input element.
			 * @param {HTMLElement} errorEl - The error message element.
			 */
			function hideError(input, errorEl) {
				errorEl.textContent = "";
				errorEl.hidden = true;
				input.setAttribute("aria-invalid", "false");
			}

			/**
			 * Validates the entire form.
			 * @returns {boolean} - True if the form is valid, false otherwise.
			 */
			function validateForm() {
				let isValid = true;

				// 1. Validate Name
				if (nameInput.value.trim() === "") {
					showError(nameInput, nameError, "Full name is required.");
					isValid = false;
				} else {
					hideError(nameInput, nameError);
				}

				// 2. Validate Email
				if (emailInput.value.trim() === "") {
					showError(emailInput, emailError, "Email is required.");
					isValid = false;
				} else if (!emailRegex.test(emailInput.value.trim())) {
					showError(
						emailInput,
						emailError,
						"A valid email (e.g., name@example.com) is required."
					);
					isValid = false;
				} else {
					hideError(emailInput, emailError);
				}

				// 3. Validate Subject
				if (subjectInput.value.trim() === "") {
					showError(subjectInput, subjectError, "Subject is required.");
					isValid = false;
				} else {
					hideError(subjectInput, subjectError);
				}

				// 4. Validate Message
				if (messageInput.value.trim() === "") {
					showError(messageInput, messageError, "Message is required.");
					isValid = false;
				} else if (messageInput.value.trim().length < 10) {
					showError(
						messageInput,
						messageError,
						"Message must be at least 10 characters long."
					);
					isValid = false;
				} else {
					hideError(messageInput, messageError);
				}

				return isValid;
			}

			form.addEventListener("submit", (event) => {
				// Prevent default form submission
				event.preventDefault();

				// Validate the form
				const isFormValid = validateForm();

				if (isFormValid) {
					// 1. Get the form data
					const name = nameInput.value.trim();
					const fromEmail = emailInput.value.trim(); // The user's email
					const subject = subjectInput.value.trim();
					const message = messageInput.value.trim();

					// 2. Define your recipient email
					const recipientEmail = "devyalchemist@gmail.com";

					// 3. Build the email body
					// Note: We create a template string for the body
					const emailBody = `
Hi Gospel,

You have a new message from:
Name: ${name}
Email: ${fromEmail}

Message:
${message}
        `;

					// 4. Encode the subject and body to be URL-safe
					const encodedSubject = encodeURIComponent(subject);
					const encodedBody = encodeURIComponent(emailBody);

					// 5. Create the special Gmail compose URL
					const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${recipientEmail}&su=${encodedSubject}&body=${encodedBody}`;

					// 6. Open Gmail in a new browser tab
					window.open(gmailUrl, "_blank");

					// 7. Show success message and hide the form
					form.hidden = true;
					successMessage.hidden = false;
					// In a real application, you would send the form data to a server here.
					console.log("Form submitted successfully!");
					console.log({
						name: nameInput.value,
						email: emailInput.value,
						subject: subjectInput.value,
						message: messageInput.value,
					});

					// Optional: Reset form fields
					// form.reset();
				} else {
					// If form is invalid, focus the first invalid field for accessibility
					const firstInvalidField = form.querySelector('[aria-invalid="true"]');
					if (firstInvalidField) {
						firstInvalidField.focus();
					}
				}
			});
		});
	</script>
</html>
